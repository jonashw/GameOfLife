<!--
		NEXT:
			add additional setup methods (from definable patterns)
			add GUI controls:
				time
				maxAge
				grid size
				setup method
-->
<!DOCTYPE html>
<html lang="en">
	<head>
		<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=ISO-8859-1">
		<style>
			html {
				overflow:hidden;
			}
			body {
				background:black;
				color:#50ff50;
				text-align:center;
				font-weight:bold;
				font-family: 'courier';
				font-size:11px;
			}
			#toolbar{
				position:fixed;
				bottom:0;
				left:0;
				background:#111;
				right:0;
			}
			.gridInput,
		   	.timeInput	{
				width:30px;
			}
			#toolbar input,
			#toolbar button,
			#toolbar label{
				margin:10px 5px;
			}
			#toolbar label {
				margin-right:0;
				font-size:14px;
			}

		</style>
		<script src="setups.js"></script>
		<script src="Grid.js"></script>
		<script src="Time.js"></script>
		<script src="simulateGeneration.js"></script>
		<script src="display.js"></script>
		<script src="../core/jQuery.js"></script>
		<script src="../core/flashService.js"></script>
		<script>
			var display,time,gridA,gridB,maxAge,toolbar;
			//set up the simulation (pure javascript)
			window.onload = function(){
				maxAge = 5;
				gridA = new Grid(40,40);
				gridB = gridA.clone();
				var displayDiv = document.getElementById('life');
				//start with a randomly-generated 'life field'
				setupRandom(gridA);
				//the time simulator, which ticks @ 20Hz, drives the life cycle
				time = new Time(20,function(){
					if(simulateGeneration(gridA, gridB, maxAge) == 0){
						time.stop();
						alert('all cells have died T__T');		
					}
					display(gridB,displayDiv);
					//alternate active/second grids
					var temp = gridA;
					gridA = gridB;
					gridB = temp;
				});
				//let's go!
				time.start();

				//set up the UI (jQuery-based)
				toolbar = $('#toolbar');
				var colsField = $('<input>')
					.attr('type','number')
					.val(gridA.cols)
					.appendTo(toolbar)
					.addClass('gridInput gridCols')
					.on('change keyupPause',function(){
						var val = $(this).val();
						var wasRunning = time.isRunning();
						if(wasRunning) time.stop();
						gridA.resizeCols(val);
					   	gridB.resizeCols(val);
						if(wasRunning) time.start();
					})
					.before('<label>columns:</label>')
				;
				var rowsField = $('<input>')
					.attr('type','number')
					.val(gridA.rows)
					.appendTo(toolbar)
					.addClass('gridInput gridRows')
					.on('change keyupPause',function(){
						var wasRunning = time.isRunning();
						if(wasRunning) time.stop();
						var val = $(this).val();
						gridA.resizeRows(val);
					   	gridB.resizeRows(val);
						if(wasRunning) time.start();
					})
					.before('<label>rows:</label>')
				;
				var timeRateField = $('<input>')
					.attr('type','number')
					.val(time.ticksPerSecond)
					.appendTo(toolbar)
					.addClass('timeInput')
					.on('change keyupPause',function(){
						var val = $(this).val();
						time.setRefreshRate(val);
					})
					.before('<label>refresh rate<small> (ticks/second)</small>:</label>')
				;
				var maxAgeField = $('<input>')
					.attr('type','number')
					.val(maxAge)
					.appendTo(toolbar)
					.addClass('gridInput')
					.on('change keyupPause',function(){
						var val = $(this).val();
						maxAge = val;
					})
					.before('<label>maximum cell age:</label>')
				;
				var resetBtn = $('<button></button>')
					.text('reset')
					.appendTo(toolbar)
					.on('click',function(){
						setupRandom(gridA);
						startBtn.trigger('click');
					})
				;
				var stopBtn = $('<button></button>')
					.text(' pause ')
					.css('width','5em')
					.appendTo(toolbar)
					.on('click',function(){
						time.stop();
						$(this).hide();
						startBtn.show();
						stepBtn.removeAttr('disabled');
					})
				;
				var startBtn = $('<button></button>')
					.text('resume')
					.css('width','5em')
					.appendTo(toolbar)
					.hide()
					.on('click',function(){
						time.start();
						$(this).hide();
						stopBtn.show();
						stepBtn.attr('disabled','true')
					})
				;
				var stepBtn = $('<button></button>')
					.text('step one tick')
					.appendTo(toolbar)
					.on('click',function(){
						time.step();
					})
					.attr('disabled','true')
				;
				var infoLink = $('<a></a>')
					.text('info')
					.attr('href','http://www.math.com/students/wonders/life/life.html')
					.attr('target','_blank')
					.css('margin-left','2em')
					.appendTo(toolbar)
				;
			};
		</script>
	</head>
	<body>
		<div id="life"></div>
		<div id="toolbar"></div>
	</body>
</html>
